<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Timeline — RNP S1 (Représentation & Narration du Projet)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Palette et variables de thème */
    :root{--bg:#0b0f14;--card:#12171d;--text:#E6E6E6;--gold:#D4AF37;--g1:#0f172a;--g2:#1f2937}

    /* Fond en dégradé piloté par --g1/--g2 (changé au scroll) */
    html,body{height:100%}
    body{background:linear-gradient(135deg,color-mix(in oklab,var(--g1) 88%,#000 12%),color-mix(in oklab,var(--g2) 88%,#000 12%));color:var(--text);transition:background 1.2s ease-in-out}

    /* Conteneur de scroll horizontal avec snap sur les éléments */
    .htrack{scroll-snap-type:x mandatory}
    .hslide{scroll-snap-align:center;transition:transform .35s ease,opacity .35s ease;opacity:.65;width:120px}

    /* Style d'image PiXi + agrandissement spécifique à la vue Timeline (pas Storyboard) */
    .pixi-img{filter:drop-shadow(0 10px 24px rgba(0,0,0,.45))}
    body:not(.gridboard) #track .pixi-img{height:110px;width:110px}
    @media (min-width:768px){body:not(.gridboard) #track .pixi-img{height:130px;width:130px}}

    /* Modale et overlay */
    .overlay{background:rgba(0,0,0,.5)}
    .dialog{background:var(--card)}

    /* Rail = « bande cinéma » sous les PiXi */
    .timeline{position:relative;min-width:100%}
    .rail{position:absolute;left:0;top:50%;transform:translateY(-50%);height:12px;border-radius:999px;opacity:.95;pointer-events:none;z-index:0;width:100%;background:linear-gradient(90deg,#0f1318 0%,#3a3f45 50%,#0f1318 100%)}
    .rail:after{content:"";position:absolute;inset:0;background:repeating-linear-gradient(90deg,transparent 0 22px,rgba(255,255,255,.08) 22px 24px);border-radius:999px}
    /* Balayage lumineux discret pour évoquer une pellicule qui défile */
    .rail::before{content:"";position:absolute;top:0;bottom:0;width:22%;left:-30%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.07),transparent);filter:blur(1px);mix-blend-mode:screen;animation:sweep 9s linear infinite}
    @keyframes sweep{from{left:-30%}to{left:110%}}

    /* Masquer les barres natives pour un look propre */
    .no-scrollbar{scrollbar-width:none}
    .no-scrollbar::-webkit-scrollbar{display:none}

    /* Bouton générique */
    .btn{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem .75rem;border-radius:.75rem;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.05)}
    .btn:hover{background:rgba(255,255,255,.08)}

    /* Curseur décoratif (désactivé en prefers-reduced-motion) */
    #cursor{position:fixed;left:0;top:0;width:8px;height:8px;border-radius:999px;background:var(--gold);box-shadow:0 0 12px rgba(212,175,55,.65);pointer-events:none;opacity:.8;transform:translate(-50%,-50%);z-index:50}
    @media (prefers-reduced-motion:reduce){.htrack{scroll-behavior:auto}.hslide{transition:none}body{transition:none}#cursor{display:none}.rail::before{display:none}}

    /* Vue Storyboard = grille 3×4 sans rail, items fluides */
    .gridboard #track{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:1.25rem;overflow:visible;scroll-snap-type:none;padding-block:2rem}
    .gridboard .hslide{width:auto;opacity:1}
    .gridboard .rail{display:none}
  </style>
</head>
<body class="antialiased selection:bg-yellow-500/20">
  <!-- Petit curseur doré qui « suit » la souris -->
  <div id="cursor"></div>

  <!-- En‑tête sobre -->
  <header class="max-w-6xl mx-auto px-6 pt-8">
    <h1 class="text-2xl md:text-3xl font-semibold tracking-tight">Timeline — RNP · Semestre 1</h1>
    <p class="text-sm text-white/80 mt-1">12 sessions · Timeline horizontale · Cliquez sur PiXi pour le détail & NotebookLM</p>
  </header>

  <!-- Zone principale : timeline + bouton de bascule centré en bas -->
  <main class="mt-6 relative">
    <section aria-label="Timeline des sessions S1" class="relative px-6">
      <!-- Piste horizontale où les cartes sont injectées en JS -->
      <div id="track" class="timeline htrack overflow-x-auto no-scrollbar flex gap-12 py-16 scroll-smooth min-w-full" tabindex="0" role="list"></div>
    </section>
    <!-- Bouton pour basculer Timeline ↔ Storyboard -->
    <div class="absolute left-1/2 -bottom-12 -translate-x-1/2">
      <button id="toggleView" class="btn text-white/80">Vue Storyboard</button>
    </div>
  </main>

  <!-- Modale d’information de session (role=dialog) -->
  <div id="dialogRoot" class="hidden fixed inset-0 overlay flex items-end sm:items-center justify-center p-4 z-50">
    <div role="dialog" aria-modal="true" aria-labelledby="dlgTitle" aria-describedby="dlgDesc" class="dialog w-full max-w-md rounded-2xl shadow-2xl ring-1 ring-white/10 p-5">
      <div class="flex items-start gap-3">
        <img id="dlgImg" class="h-12 w-12 object-contain pixi-img" alt="" width="48" height="48" loading="lazy" decoding="async" />
        <div class="min-w-0">
          <h2 id="dlgTitle" class="text-base font-semibold"></h2>
          <p id="dlgDesc" class="text-sm text-white/80 mt-1"></p>
          <a id="dlgLink" aria-disabled="false" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 mt-3 text-sm font-medium text-black bg-[var(--gold)] hover:brightness-95 px-3 py-1.5 rounded-lg transition" href="#">Ouvrir dans NotebookLM</a>
        </div>
      </div>
      <div class="flex justify-end mt-4">
        <button id="dlgClose" class="text-sm text-white/80 hover:text-white px-3 py-1.5 rounded-md ring-1 ring-white/10">Fermer (Esc)</button>
      </div>
    </div>
  </div>

  <!-- Zone SR pour annoncer la session active -->
  <div id="srLive" class="sr-only" aria-live="polite"></div>

  <footer class="max-w-6xl mx-auto px-6 py-10 text-xs text-white/70 text-center">© 2025 · Projet <span class="font-medium text-[var(--gold)]">RNP</span> — Timeline S1</footer>

  <script>
    //------------------------------
    // 1) CONFIG (haut de fichier)
    //------------------------------
    const DATA={
      // Session à afficher au chargement (ex: 7 => S7). 1 à 12
      startSession:7,
      // Dégradés utilisés pour teinter le fond selon l’élément centré
      gradients:[["#0f172a","#1f2937"],["#111827","#334155"],["#0b1220","#2b3440"],["#101418","#2a2f36"],["#131313","#2b2b2b"],["#0e1a1a","#243c3c"],["#15161a","#2c2d33"],["#12151a","#2b3340"],["#151519","#2e2a22"],["#14151a","#2f2d35"],["#16161b","#302f3a"],["#171717","#343434"]],
      // Contenu S1→S12 (textes + liens + images)
      sessions:[
        {id:"S1",type:"FUN",titre:"Cube Identitaire (FUN)",resume:"Prise en main + modéliser un cube-persona pour se présenter.",notebook:"https://notebooklm.google.com/placeholder/S1",pixi:"assets/pixi-identite.png"},
        {id:"S2",type:"THÉORIE",titre:"Grammaire Temps Réel & Caméra (THÉORIE)",resume:"Navigation moteur temps réel, valeurs de plan, focale & expo.",notebook:"https://notebooklm.google.com/placeholder/S2",pixi:"assets/pixi-camera.png"},
        {id:"S3",type:"TECHNIQUE",titre:"Initiation Mise en Page (TECHNIQUE)",resume:"Première planche narrative A3 et lien modèle 3D ↔ mise en page.",notebook:"https://notebooklm.google.com/placeholder/S3",pixi:"assets/pixi-layout.png"},
        {id:"S4",type:"FUN",titre:"Pictionary 3D (FUN)",resume:"Modélisation rapide chronométrée pour lire/écrire des formes.",notebook:"https://notebooklm.google.com/placeholder/S4",pixi:"assets/pixi-pictionary.png"},
        {id:"S5",type:"THÉORIE",titre:"Grammaire Ciné/Photo & DA (THÉORIE)",resume:"Lumière, cadrage, LUTs : décoder des plans pour une DA claire.",notebook:"https://notebooklm.google.com/placeholder/S5",pixi:"assets/pixi-rembrandt.png"},
        {id:"S6",type:"TECHNIQUE",titre:"Hygiène Modèle & Plugins (TECHNIQUE)",resume:"Nettoyage, pivots, nomenclature, plugins clés pour le workflow.",notebook:"https://notebooklm.google.com/placeholder/S6",pixi:"assets/pixi-hygiene.png"},
        {id:"S7",type:"FUN",titre:"Idéation par IA & Lumière (FUN)",resume:"Générer des ambiances & style-guides, bases de prompt structuré.",notebook:"https://notebooklm.google.com/placeholder/S7",pixi:"assets/pixi-ia.png"},
        {id:"S8",type:"THÉORIE",titre:"Lumière & Caméras Avancées (THÉORIE)",resume:"Key/Fill/Rim, cohérence des trajectoires caméra pour le récit.",notebook:"https://notebooklm.google.com/placeholder/S8",pixi:"assets/pixi-3points.png"},
        {id:"S9",type:"TECHNIQUE",titre:"Matériaux PBR & D5 (TECHNIQUE)",resume:"Roughness/Metalness, normales, comparaison moteurs de rendu.",notebook:"https://notebooklm.google.com/placeholder/S9",pixi:"assets/pixi-pbr.png"},
        {id:"S10",type:"FUN",titre:"Montage & Rythme (FUN/THÉORIE)",resume:"3 actes, titrage, transitions — assembler un rough-cut lisible.",notebook:"https://notebooklm.google.com/placeholder/S10",pixi:"assets/pixi-montage.png"},
        {id:"S11",type:"THÉORIE",titre:"Prompt Engineering Avancé (THÉORIE)",resume:"Structure avancée des prompts pour résultats précis & traçables.",notebook:"https://notebooklm.google.com/placeholder/S11",pixi:"assets/pixi-prompt.png"},
        {id:"S12",type:"TECHNIQUE",titre:"Restitution Finale & Jury (TECH/ÉVAL)",resume:"Exports propres, QA, présentation des livrables au jury.",notebook:"https://notebooklm.google.com/placeholder/S12",pixi:"assets/pixi-jury.png"}
      ],
      pixiFallback:"assets/pixi-default.png"
    };

    //------------------------------
    // 2) UTILITAIRES DOM + sécurité HTML
    //------------------------------
    const $=(s,r=document)=>r.querySelector(s), $$=(s,r=document)=>[...r.querySelectorAll(s)];
    const escapeHTML=s=>String(s).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));

    //------------------------------
    // 3) RENDU DES CARTES SUR LA PISTE
    //------------------------------
    const track=$('#track');
    const short=(t,max=80)=>{t=String(t||'');return t.length>max?t.slice(0,max-1)+'…':t};

    // Fabrique une carte PiXi + légende (Sx + titre)
    const makeCard=(s,idx)=>{
      const img=s.pixi||DATA.pixiFallback;
      const el=document.createElement('article');
      el.className='hslide shrink-0 relative text-center';
      el.setAttribute('role','listitem');
      el.dataset.index=idx;
      el.dataset.type=s.type||'';
      el.innerHTML=`
        <button class="openDlg block mx-auto -mb-1" aria-label="Détails ${escapeHTML(s.id)} — ${escapeHTML(s.titre)}" data-index="${idx}" data-tip="${escapeHTML(short(s.resume))}">
          <img src="${escapeHTML(img)}" alt="PiXi — ${escapeHTML(s.id)}" class="h-20 w-20 md:h-24 md:w-24 object-contain pixi-img" width="96" height="96" loading="lazy" decoding="async" />
        </button>
        <div class="mt-2">
          <span class="text-[11px] tracking-widest uppercase text-white/60">${escapeHTML(s.id)}</span>
          <h3 class="text-sm md:text-base font-medium leading-tight">${escapeHTML(s.titre)}</h3>
        </div>`;
      return el;
    };

    // Injection des 12 sessions
    DATA.sessions.forEach((s,i)=>track.appendChild(makeCard(s,i)));

    //------------------------------
    // 4) « Bande cinéma » : rail sous la piste
    //------------------------------
    const rail=document.createElement('div');
    rail.className='rail';
    track.appendChild(rail);

    // Garde un fond uniforme mais recalculé à la bonne largeur
    const buildRailGradient=()=>{ rail.style.background='linear-gradient(90deg,#0f1318 0%,#3a3f45 50%,#0f1318 100%)' };

    // Mesure via scrollWidth (plus robuste que la position du dernier item)
    let rafId=null; // évite les recalculs multiples
    const layoutRail=()=>{ if(rafId) cancelAnimationFrame(rafId); rafId=requestAnimationFrame(()=>{ rail.style.width=track.scrollWidth+"px"; buildRailGradient(); }); };

    layoutRail(); // initial
    addEventListener('resize',layoutRail);
    // Recalcule quand les images finissent de charger
    [...track.querySelectorAll('img')].forEach(img=>{ if(img.complete) return; img.addEventListener('load',layoutRail,{once:true}) });
    if('ResizeObserver' in window){ const ro=new ResizeObserver(layoutRail); ro.observe(track) }

    //------------------------------
    // 5) FOND DYNAMIQUE : applique un dégradé selon l’élément centré
    //------------------------------
    const applyGradient=i=>{
      const g=DATA.gradients[i]||DATA.gradients[0];
      document.documentElement.style.setProperty('--g1',g[0]);
      document.documentElement.style.setProperty('--g2',g[1]);
      $('#srLive').textContent=`Session active ${DATA.sessions[i].id} — ${DATA.sessions[i].titre}`; // annonce SR
    };

    //------------------------------
    // 6) DÉTECTION DE L’ÉLÉMENT CENTRÉ + effets « zoom-out »
    //------------------------------
    let currentIndex=0; let currentEl=null;
    const io=new IntersectionObserver(ents=>{
      ents.forEach(e=>{
        if(e.isIntersecting){
          currentIndex=+e.target.dataset.index;
          applyGradient(currentIndex);
          if(currentEl) currentEl.removeAttribute('aria-current');
          currentEl=e.target; currentEl.setAttribute('aria-current','true');
        }
      })
    },{root:track,threshold:.6});
    $$('.hslide',track).forEach(el=>io.observe(el));

    // Effet de profondeur basé sur la distance au centre du viewport de la piste
    const slides=$$('.hslide',track);
    let rafDepth=null;
    const updateDepth=()=>{
      if(rafDepth) return;
      rafDepth=requestAnimationFrame(()=>{
        const tb=track.getBoundingClientRect();
        const center=tb.left + tb.width/2;
        slides.forEach(el=>{
          const rb=el.getBoundingClientRect();
          const ec=rb.left + rb.width/2;
          const d=Math.min(1, Math.abs((ec-center)/(tb.width/2))); // 0 (centre) → 1 (bord)
          const scale=1 - 0.15*d;    // zoom-out vers les bords
          const y=8*d;               // légère translation verticale
          const op=0.45 + 0.55*(1-d);// atténuation progressive
          el.style.transform=`translateY(${y}px) scale(${scale})`;
          el.style.opacity=op.toFixed(3);
        });
        rafDepth=null;
      });
    };
    updateDepth();
    track.addEventListener('scroll',updateDepth,{passive:true});
    addEventListener('resize',updateDepth);

    //------------------------------
    // 7) MODALE : ouverture, fermeture, piège de focus
    //------------------------------
    const dlg=$('#dialogRoot'), dlgTitle=$('#dlgTitle'), dlgDesc=$('#dlgDesc'), dlgLink=$('#dlgLink'), dlgImg=$('#dlgImg'), dlgClose=$('#dlgClose');
    let lastFocus=null;

    const openDlg=idx=>{
      const s=DATA.sessions[idx];
      dlgTitle.textContent=s.titre; dlgDesc.textContent=s.resume; dlgImg.src=s.pixi||DATA.pixiFallback;
      const isValid=s.notebook && !s.notebook.includes('placeholder');
      dlgLink.href=isValid ? s.notebook : '#';
      dlgLink.setAttribute('aria-disabled', String(!isValid));
      dlgLink.tabIndex=isValid ? 0 : -1;
      dlgLink.classList.toggle('opacity-50', !isValid);
      dlgLink.classList.toggle('cursor-not-allowed', !isValid);
      dlgLink.classList.toggle('pointer-events-none', !isValid);

      dlg.classList.remove('hidden');
      lastFocus=document.activeElement;
      const focusables=[...dlg.querySelectorAll('a, button, input, select, textarea, [tabindex]:not([tabindex="-1"])')].filter(el=>!el.disabled);
      if(focusables.length){ focusables[0].focus(); }
    };

    const closeDlg=()=>{ dlg.classList.add('hidden'); if(lastFocus) lastFocus.focus(); };

    // Fermeture par clic sur l’overlay, bouton « Fermer », ou touche Échap
    dlg.addEventListener('click',e=>{ if(e.target===dlg) closeDlg() });
    dlgClose.addEventListener('click',closeDlg);
    document.addEventListener('keydown',e=>{ if(e.key==='Escape' && !dlg.classList.contains('hidden')) closeDlg() });

    // Piège de focus clavier à l’intérieur de la modale
    dlg.addEventListener('keydown',e=>{
      if(e.key!=='Tab') return;
      const focusables=[...dlg.querySelectorAll('a, button, input, select, textarea, [tabindex]:not([tabindex="-1"])')].filter(el=>!el.disabled && el.offsetParent!==null);
      if(!focusables.length){ e.preventDefault(); return; }
      const first=focusables[0], last=focusables[focusables.length-1];
      if(e.shiftKey && document.activeElement===first){ e.preventDefault(); last.focus(); }
      else if(!e.shiftKey && document.activeElement===last){ e.preventDefault(); first.focus(); }
    });

    // Ouverture via clic sur une carte
    track.addEventListener('click',e=>{ const btn=e.target.closest('.openDlg'); if(!btn) return; openDlg(+btn.dataset.index) });

    //------------------------------
    // 8) NAVIGATION CLAVIER GAUCHE/DROITE ET DÉMARRAGE
    //------------------------------
    const prefersReduced = matchMedia('(prefers-reduced-motion: reduce)').matches;
    const goTo=i=>{ const c=Math.max(0,Math.min(DATA.sessions.length-1,i)); const t=$(`article[data-index="${c}"]`); if(t) t.scrollIntoView({behavior: prefersReduced? 'auto' : 'smooth', inline:'center', block:'nearest'}) };

    // Flèches gauche/droite quand la modale est fermée
    document.addEventListener('keydown',e=>{ if(dlg.classList.contains('hidden')){ if(e.key==='ArrowRight') goTo(currentIndex+1); if(e.key==='ArrowLeft') goTo(currentIndex-1); } });

    // Centrer dès l’ouverture sur la session choisie (startSession)
    const startAt=Math.max(0,Math.min((DATA.startSession||1)-1,DATA.sessions.length-1));
    goTo(startAt);
    applyGradient(startAt);

    //------------------------------
    // 9) BASCULE VUE TIMELINE ↔ STORYBOARD
    //------------------------------
    const toggle=$('#toggleView');
    toggle.addEventListener('click',()=>{
      document.body.classList.toggle('gridboard');
      toggle.textContent=document.body.classList.contains('gridboard')? 'Vue Timeline' : 'Vue Storyboard';
      layoutRail(); // rail inutile en grille, mais recalculé au retour timeline
    });

    //------------------------------
    // 10) CURSEUR DORÉ (animation simple via rAF)
    //------------------------------
    (function(){
      const c=$('#cursor'); if(!c) return;
      let x=0,y=0, tx=0, ty=0, raf;
      const loop=()=>{ tx+=(x-tx)*.18; ty+=(y-ty)*.18; c.style.transform=`translate(${tx}px, ${ty}px)`; raf=requestAnimationFrame(loop) };
      addEventListener('mousemove',e=>{ x=e.clientX; y=e.clientY; if(!raf) loop(); });
      addEventListener('mouseleave',()=>{ cancelAnimationFrame(raf); raf=null; c.style.opacity='.0' });
      addEventListener('mouseenter',()=>{ c.style.opacity='.8' });
    })();
  </script>
</body>
</html>